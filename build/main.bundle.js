!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.ReduxP2PGunTransport=n():t.ReduxP2PGunTransport=n()}(window,function(){return function(t){var n={};function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(o,r,function(n){return t[n]}.bind(null,r));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=12)}([function(t,n,e){"use strict";var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(o=window)}t.exports=o},function(t,n,e){"use strict";var o,r,i=t.exports={};function u(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(o===setTimeout)return setTimeout(t,0);if((o===u||!o)&&setTimeout)return o=setTimeout,setTimeout(t,0);try{return o(t,0)}catch(n){try{return o.call(null,t,0)}catch(n){return o.call(this,t,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:u}catch(t){o=u}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var f,c=[],l=!1,p=-1;function h(){l&&f&&(l=!1,f.length?c=f.concat(c):p=-1,c.length&&g())}function g(){if(!l){var t=s(h);l=!0;for(var n=c.length;n;){for(f=c,c=[];++p<n;)f&&f[p].run();p=-1,n=c.length}f=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(n){try{return r.call(null,t)}catch(n){return r.call(this,t)}}}(t)}}function d(t,n){this.fun=t,this.array=n}function v(){}i.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)n[e-1]=arguments[e];c.push(new d(t,n)),1!==c.length||l||s(g)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,n,e){"use strict";var o=e(9),r=e(6).EventEmitter;t.exports=function(t){function n(e){var o=this;if(!(this instanceof n))return new n(e);this.gun=t(e),this.opts=e||{},this.room=this.opts.room||"lounge",this.gun.get(this.room).get("actions").map().on(function(t){var n=JSON.parse(t.action);o.emit("action",{id:t.id,action:n})})}return o.inherits(n,r),n.prototype.replicate=function(t){var n={id:t.id,action:JSON.stringify(t.action)};this.gun.get(this.room).get("actions").set(n)},n}},function(t,n,e){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,n,e){"use strict";(function(t,n){var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var o;"undefined"!=typeof window&&(o=window),void 0!==t&&(o=t);var r=(o=o||{}).console||{log:function(){}};function i(t){return t.slice?i[n(t)]:function(e,o){t(e={exports:{}}),i[n(o)]=e.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}var u=n;i(function(t){var n={};n.fns=n.fn={is:function(t){return!!t&&"function"==typeof t}},n.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},n.num={is:function(t){return!o(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},n.text={is:function(t){return"string"==typeof t}},n.text.ify=function(t){return n.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},n.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},n.text.match=function(t,e){var o=!1;if(t=t||"",e=n.text.is(e)?{"=":e}:e||{},n.obj.has(e,"~")&&(t=t.toLowerCase(),e["="]=(e["="]||e["~"]).toLowerCase()),n.obj.has(e,"="))return t===e["="];if(n.obj.has(e,"*")){if(t.slice(0,e["*"].length)!==e["*"])return!1;o=!0,t=t.slice(e["*"].length)}if(n.obj.has(e,"!")){if(t.slice(-e["!"].length)!==e["!"])return!1;o=!0}if(n.obj.has(e,"+")&&n.list.map(n.list.is(e["+"])?e["+"]:[e["+"]],function(n){if(!(t.indexOf(n)>=0))return!0;o=!0}))return!1;if(n.obj.has(e,"-")&&n.list.map(n.list.is(e["-"])?e["-"]:[e["-"]],function(n){if(!(t.indexOf(n)<0))return!0;o=!0}))return!1;if(n.obj.has(e,">")){if(!(t>e[">"]))return!1;o=!0}if(n.obj.has(e,"<")){if(!(t<e["<"]))return!1;o=!0}if(n.obj.has(e,"?")){if(!function(t,n){for(var e,o=-1,r=0;e=n[r++];)if(!~(o=t.indexOf(e,o+1)))return!1;return!0}(t,e["?"]))return!1;o=!0}return o},n.list={is:function(t){return t instanceof Array}},n.list.slit=Array.prototype.slice,n.list.sort=function(t){return function(n,e){return n&&e?(n=n[t])<(e=e[t])?-1:n>e?1:0:0}},n.list.map=function(t,n,e){return a(t,n,e)},n.list.index=1,n.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=function(t,n,e){return(t||{})[n]=e,t},n.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},n.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},n.obj.ify=function(t){if(i(t))return t;try{t=JSON.parse(t)}catch(n){t={}}return t},function(){var t;function e(n,e){u(this,e)&&t!==this[e]||(this[e]=n)}n.obj.to=function(t,n){return a(t,e,n=n||{}),n}}(),n.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function t(t,n){var e=this.n;if(!e||!(n===e||i(e)&&u(e,n)))return!!n||void 0}n.obj.empty=function(n,e){return!n||!a(n,t,{n:e})}}(),function(){function t(n,e){if(2===arguments.length)return t.r=t.r||{},void(t.r[n]=e);t.r=t.r||[],t.r.push(n)}var r=Object.keys;n.obj.map=function(a,s,f){var c,l,p,h,g,d=0,v=e(s);if(t.r=null,r&&i(a)&&(h=r(a),g=!0),o(a)||h)for(l=(h||a).length;d<l;d++){var m=d+n.list.index;if(v){if((p=g?s.call(f||this,a[h[d]],h[d],t):s.call(f||this,a[d],m,t))!==c)return p}else if(s===a[g?h[d]:d])return h?h[d]:m}else for(d in a)if(v){if(u(a,d)&&(p=f?s.call(f,a[d],d,t):s(a[d],d,t))!==c)return p}else if(s===a[d])return d;return v?t.r:n.list.index?0:-1}}(),n.time={},n.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};var e=n.fn.is,o=n.list.is,r=n.obj,i=r.is,u=r.has,a=r.map;t.exports=n})(i,"./type"),i(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(e instanceof Function){var r={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(r.back=n.last||n).to=r,n.last=r}return(n=n.to)&&void 0!==e&&n.next(e),n}})(i,"./onto"),i(function(t){if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var n=JSON.stringify;t.exports=function(t,e,o,r,i){if(t<e)return{defer:!0};if(e<o)return{historical:!0};if(o<e)return{converge:!0,incoming:!0};if(e===o){if((r=n(r)||"")===(i=n(i)||""))return{state:!0};if(r<i)return{converge:!0,current:!0};if(i<r)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+r+" to "+i+" at "+e+" to "+o+"!"}}})(i,"./HAM"),i(function(t){var n=i("./type"),e={is:function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(a(t)||r(t)||u(t))||(e.rel.is(t)||!1)))},rel:{_:"#"}};(function(){function t(t,n){var e=this;return e.id?e.id=!1:n==o&&a(t)?void(e.id=t):e.id=!1}e.rel.is=function(n){if(n&&n[o]&&!n._&&f(n)){var e={};if(l(n,t,e),e.id)return e.id}return!1}})(),e.rel.ify=function(t){return c({},o,t)},n.obj.has._=".";var o=e.rel._,r=n.bi.is,u=n.num.is,a=n.text.is,s=n.obj,f=s.is,c=s.put,l=s.map;t.exports=e})(i,"./val"),i(function(t){var n=i("./type"),e=i("./val"),o={_:"_",soul:function(t,n){return t&&t._&&t._[n||c]}};o.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[c]=n.soul||t._[c]||f(),t},o.soul._=e.rel._,function(){function t(t,n){if(n!==o._)return!e.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}o.is=function(n,e,r){var i;return!!u(n)&&(!!(i=o.soul(n))&&!s(n,t,{as:r,cb:e,s:i,n:n}))}}(),function(){function t(t,n){var o,r=this.o;r.map?void 0===(o=r.map.call(this.as,t,""+n,r.node))?a(r.node,n):r.node&&(r.node[n]=o):e.is(t)&&(r.node[n]=t)}o.ify=function(n,e,r){return e?"string"==typeof e?e={soul:e}:e instanceof Function&&(e={map:e}):e={},e.map&&(e.node=e.map.call(r,n,void 0,e.node||{})),(e.node=o.soul.ify(e.node||{},e))&&s(n,t,{o:e,as:r}),e.node}}();var r=n.obj,u=r.is,a=r.del,s=r.map,f=n.text.random,c=o.soul._;t.exports=o})(i,"./node"),i(function(t){var n=i("./type"),e=i("./node");function o(){var t;return t=r(),u<t?(a=0,u=t+o.drift):u=t+(a+=1)/s+o.drift}var r=n.time.is,u=-1/0,a=0,s=1e3,f="undefined"!=typeof performance&&(performance.timing&&performance);f&&f.timing&&f.timing.navigationStart||(f=!1);o._=">",o.drift=0,o.is=function(t,n,e){var r=n&&t&&t[y]&&t[y][o._]||e;if(r)return m(r=r[n])?r:-1/0},o.lex=function(){return o().toString(36).replace(".","")},o.ify=function(t,n,r,i,u){if(!t||!t[y]){if(!u)return;t=e.soul.ify(t,u)}var a=p(t[y],o._);return c!==n&&n!==y&&(m(r)&&(a[n]=r),c!==i&&(t[n]=i)),t},o.to=function(t,n,r){var i=t[n];return g(i)&&(i=v(i)),o.ify(r,n,o.is(t,n),i,e.soul(t))},function(){function t(t,n){y!==n&&o.ify(this.o,n,this.s)}o.map=function(n,e,r){var i,u=g(u=n||e)?u:null;return n=b(n=n||e)?n:null,u&&!n?(e=m(e)?e:o(),u[y]=u[y]||{},d(u,t,{o:u,s:e}),u):(r=r||g(e)?e:i,e=m(e)?e:o(),function(o,u,a,s){if(!n)return t.call({o:a,s:e},o,u),o;n.call(r||this||{},o,u,a,s),h(a,u)&&i===a[u]||t.call({o:a,s:e},o,u)})}}();var c,l=n.obj,p=l.as,h=l.has,g=l.is,d=l.map,v=l.copy,m=n.num.is,b=n.fn.is,y=e._;t.exports=o})(i,"./state"),i(function(t){var n=i("./type"),e=i("./val"),o=i("./node"),r={};!function(){function t(t,e){if(!t||e!==o.soul(t)||!o.is(t,this.fn,this.as))return!0;this.cb&&(n.n=t,n.as=this.as,this.cb.call(n.as,t,e,n))}function n(t){t&&o.is(n.n,t,n.as)}r.is=function(n,e,o,r){return!(!n||!s(n)||l(n))&&!h(n,t,{cb:e,fn:o,as:r})}}(),function(){function t(t,n){var r;return(r=function(t,n){var e,o=t.seen,r=o.length;for(;r--;)if(e=o[r],n.obj===e.obj)return e;o.push(n)}(t,n))?r:(n.env=t,n.soul=a,o.ify(n.obj,i,n)&&(t.graph[e.rel.is(n.rel)]=n.node),n)}function i(n,r,i){var a,s,p=this,h=p.env;if(o._===r&&c(n,e.rel._))return i._;if(a=l(n,r,i,p,h)){if(r||(p.node=p.node||i||{},c(n,o._)&&(p.node._=g(n._)),p.node=o.soul.ify(p.node,e.rel.is(p.rel)),p.rel=p.rel||e.rel.ify(o.soul(p.node))),(s=h.map)&&(s.call(h.as||{},n,r,i,p),c(i,r))){if(n=i[r],u===n)return void f(i,r);if(!(a=l(n,r,i,p,h)))return}if(!r)return p.node;if(!0===a)return n;if((s=t(h,{obj:n,path:p.path.concat(r)})).node)return s.rel}}function a(t){var n=this,r=e.rel.is(n.rel),i=n.env.graph;n.rel=n.rel||e.rel.ify(t),n.rel[e.rel._]=t,n.node&&n.node[o._]&&(n.node[o._][e.rel._]=t),c(i,r)&&(i[t]=i[r],f(i,r))}function l(t,o,r,i,u){var a;return!!e.is(t)||(s(t)?1:(a=u.invalid)?l(t=a.call(u.as||{},t,o,r),o,r,i,u):(u.err="Invalid value at '"+i.path.concat(o).join(".")+"'!",void(n.list.is(t)&&(u.err+=" Use `.set(item)` instead of an Array."))))}r.ify=function(n,o,r){var i={path:[],obj:n};return o?"string"==typeof o?o={soul:o}:o instanceof Function&&(o.map=o):o={},o.soul&&(i.rel=e.rel.ify(o.soul)),o.graph=o.graph||{},o.seen=o.seen||[],o.as=o.as||r,t(o,i),o.root=i.node,o.graph}}(),r.node=function(t){var n=o.soul(t);if(n)return p({},n,t)},function(){function t(t,n){var i,u;if(o._!==n)(i=e.rel.is(t))?(u=this.opt.seen[i])?this.obj[n]=u:this.obj[n]=this.opt.seen[i]=r.to(this.graph,i,this.opt):this.obj[n]=t;else{if(l(t,e.rel._))return;this.obj[n]=g(t)}}r.to=function(n,e,o){if(n){var r={};return o=o||{seen:{}},h(n[e],t,{obj:r,graph:n,opt:o}),r}}}();n.fn.is;var u,a=n.obj,s=a.is,f=a.del,c=a.has,l=a.empty,p=a.put,h=a.map,g=a.copy;t.exports=r})(i,"./graph"),i(function(t){i("./onto"),t.exports=function(t,n){if(this.on){if(!(t instanceof Function)){if(!t||!n)return;var e=t["#"]||t,o=(this.tag||empty)[e];if(!o)return;return o=this.on(e,n),clearTimeout(o.err),!0}e=n&&n["#"]||Math.random().toString(36).slice(2);if(!t)return e;var r=this.on(e,t,n);return r.err=r.err||setTimeout(function(){r.next({err:"Error: No ACK received yet."}),r.off()},(this.opt||{}).lack||9e3),e}}})(i,"./ask"),i(function(t){var n=i("./type");var e=n.time.is;t.exports=function(t){var o={s:{}};return t=t||{max:1e3,age:9e3},o.check=function(t){var n;return!!(n=o.s[t])&&(n.pass?n.pass=!1:o.track(t))},o.track=function(r,i){var u=o.s[r]||(o.s[r]={});return u.was=e(),i&&(u.pass=!0),o.to||(o.to=setTimeout(function(){var r=e();n.obj.map(o.s,function(e,i){t.age>r-e.was||n.obj.del(o.s,i)}),o.to=null},t.age+9)),u},o}})(i,"./dup"),i(function(t){function n(t){return t instanceof n?(this._={gun:this}).gun:this instanceof n?n.create(this._={gun:this,opt:t}):new n(t)}n.is=function(t){return t instanceof n||t&&t._&&t._.gun&&!0||!1},n.version=.9,n.chain=n.prototype,n.chain.toJSON=function(){};var e=i("./type");e.obj.to(e,n),n.HAM=i("./HAM"),n.val=i("./val"),n.node=i("./node"),n.state=i("./state"),n.graph=i("./graph"),n.on=i("./onto"),n.ask=i("./ask"),n.dup=i("./dup"),function(){function t(e){var r,i,u=this.as,a=u.gun;(i=e["#"])||(i=e["#"]=c(9)),(r=u.dup).check(i)?u.out===e.out&&(e.out=o,this.to.next(e)):(r.track(i),u.ask(e["@"],e)||(e.get&&n.on.get(e,a),e.put&&n.on.put(e,a)),this.to.next(e),u.out||(e.out=t,u.on("out",e)))}n.create=function(e){e.root=e.root||e,e.graph=e.graph||{},e.on=e.on||n.on,e.ask=e.ask||n.ask,e.dup=e.dup||n.dup();var o=e.gun.opt(e.opt);return e.once||(e.on("in",t,e),e.on("out",t,g(e,{out:t})),n.on("create",e),e.on("create",e)),e.once=1,o}}(),function(){function t(t,e,o,r){var i=this,u=n.state.is(o,e);if(!u)return i.err="Error: No state on '"+e+"' in node '"+r+"'!";var a=i.graph[r]||y,s=n.state.is(a,e,!0),f=a[e],c=n.HAM(i.machine,u,s,t,f);c.incoming?(i.put[r]=n.state.to(o,e,i.put[r]),(i.diff||(i.diff={}))[r]=n.state.to(o,e,i.diff[r]),i.souls[r]=!0):c.defer&&(i.defer=u<(i.defer||1/0)?u:i.defer)}function e(t,n){var e=this,o=e.gun._,a=(o.next||y)[n];if(!a){if(!(o.opt||y).super)return void(e.souls[n]=!1);a=e.gun.get(n)._}var s=e.map[n]={put:t,get:n,gun:a.gun},f={ctx:e,msg:s};e.async=!!o.tag.node,e.ack&&(s["@"]=e.ack),d(t,r,f),e.async&&(e.and||o.on("node",function(t){this.to.next(t),t===e.map[t.get]&&(e.souls[t.get]=!1,d(t.put,i,t),d(e.souls,function(t){if(t)return t})||e.c||(e.c=1,this.off(),o.stop={},d(e.map,u,e)))}),e.and=!0,o.on("node",s))}function r(t,e){var o=this.ctx,r=o.graph,i=this.msg,u=i.get,a=i.put,s=i.gun._;r[u]=n.state.to(a,e,r[u]),o.async||(s.put=n.state.to(a,e,s.put))}function i(t,e){var o=this.put,r=this.gun._;r.put=n.state.to(o,e,r.put)}function u(t,n){t.gun&&t.gun._.on("in",t)}n.on.put=function(r,i){var a=i._,s={gun:i,graph:a.graph,put:{},map:{},souls:{},machine:n.state(),ack:r["@"]};if(n.graph.is(r.put,null,t,s)||(s.err="Error: Invalid graph!"),s.err)return a.on("in",{"@":r["#"],err:n.log(s.err)});d(s.put,e,s),s.async||(a.stop={},d(s.map,u,s)),o!==s.defer&&setTimeout(function(){n.on.put(r,i)},s.defer-s.machine),s.diff&&a.on("put",g(r,{put:s.diff}))},n.on.get=function(t,e){var o=e._,r=t.get[m],i=o.graph[r],u=t.get[b],a=(o.next||(o.next={}))[r];if(!i||!a)return o.on("get",t);if(u){if(!h(i,u))return o.on("get",t);i=n.state.to(i,u)}else i=n.obj.copy(i);i=n.graph.node(i),o.on("in",{"@":t["#"],how:"mem",put:i,gun:e}),o.on("get",t)}}(),n.chain.opt=function(t){t=t||{};var e=this._,o=t.peers||t;return p(t)||(t={}),p(e.opt)||(e.opt=t),f(o)&&(o=[o]),a(o)&&(o=d(o,function(t,n,e){e(t,{url:t})}),p(e.opt.peers)||(e.opt.peers={}),e.opt.peers=g(o,e.opt.peers)),e.opt.peers=e.opt.peers||{},g(t,e.opt),n.on("opt",e),e.opt.uuid=e.opt.uuid||function(){return v()+c(12)},this};var o,a=n.list.is,s=n.text,f=s.is,c=s.random,l=n.obj,p=l.is,h=l.has,g=l.to,d=l.map,v=(l.copy,n.state.lex),m=n.val.rel._,b=".",y=(n.node._,n.val.rel.is,{});r.debug=function(t,n){return r.debug.i&&t===r.debug.i&&r.debug.i++&&(r.log.apply(r,arguments)||n)},n.log=function(){return!n.log.off&&r.log.apply(r,arguments),[].slice.call(arguments).join(" ")},n.log.once=function(t,e,o){return(o=n.log.once)[t]=o[t]||0,o[t]++||n.log(e)},n.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, feel free to ask for help on https://gitter.im/amark/gun and ask StackOverflow questions tagged with 'gun'!"),"undefined"!=typeof window&&(window.Gun=n);try{void 0!==u&&(u.exports=n)}catch(t){}t.exports=n})(i,"./root"),i(function(t){var n=i("./root");n.chain.back=function(t,o){if(-1===(t=t||1)||1/0===t)return this._.root.gun;if(1===t)return(this._.back||this._).gun;var r=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var i=0,u=t.length,a=r;i<u;i++)a=(a||e)[t[i]];return void 0!==a?o?this:a:(a=r.back)?a.gun.back(t,o):void 0}if(t instanceof Function){var s;for(a={back:r};(a=a.back)&&!(s=t(a,o)););return s}return n.num.is(t)?(r.back||r).gun.back(t-1):this};var e={}})(i,"./back"),i(function(t){var n=i("./root");function e(t){var e,o=this.as,r=o.back,i=o.root;if(t.I||(t.I=o.gun),t.gun||(t.gun=o.gun),this.to.next(t),e=t.get){if(e["#"]||o.soul){if(e["#"]=e["#"]||o.soul,t["#"]||(t["#"]=b(9)),r=i.gun.get(e["#"])._,e=e["."]){if(g(r.put,e))return void r.on("in",{gun:r.gun,put:n.state.to(r.put,e),get:r.get})}else{if(g(r,"put")&&r.on("in",r),r.ack)return;t.gun=r.gun,r.ack=-1}return i.ask(c,t),i.on("in",t)}if(i.now&&(i.now[o.id]=i.now[o.id]||!0),e["."])return o.get?(t={get:{".":o.get},gun:o.gun},(r.ask||(r.ask={}))[o.get]=t.gun._,r.on("out",t)):(t={get:{},gun:o.gun},r.on("out",t));if(o.ack=o.ack||-1,o.get)return t.gun=o.gun,e["."]=o.get,(r.ask||(r.ask={}))[o.get]=t.gun._,r.on("out",t)}return r.on("out",t)}function o(t){var e,o=this,i=this.as,a=t.gun._,c=t.put;if(i.get&&t.get!==i.get&&(t=v(t,{get:i.get})),i.has&&a!==i&&(t=v(t,{gun:i.gun}),a.ack&&(i.ack=a.ack)),_===i.get&&c&&c["#"]&&(i._id=c["#"]),l===c){if(o.to.next(t),i.soul)return;return u(i,t,o),i.has&&f(i,t),d(a.echo,i.id),void d(i.map,a.id)}return i.soul?(o.to.next(t),u(i,t,o),void m(c,s,{at:t,cat:i})):(e=n.val.rel.is(c))?(r(i,t,a,e),o.to.next(t),void u(i,t,o)):n.val.is(c)?(i.has||i.soul?f(i,t):(a.has||a.soul)&&((a.echo||(a.echo={}))[i.id]=i,(i.map||(i.map={}))[a.id]=i.map[a.id]||{at:a}),o.to.next(t),void u(i,t,o)):(i.has&&a!==i&&g(a,"put")&&(i.put=a.put),(e=n.node.soul(c))&&a.has&&(a.put=i.root.gun.get(e)._.put),o.to.next(t),u(i,t,o),r(i,t,a,e),void m(c,s,{at:t,cat:i}))}function r(t,e,o,i){if(i&&_!==t.get){var u=t.root.gun.get(i)._;if(t.has?o=u:o.has&&r(o,e,o,i),o!==t){(o.echo||(o.echo={}))[t.id]=t,t.has&&!(t.map||p)[o.id]&&f(t,e),u=(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o};var a=t.root.now;if(i===u.rel){if(!a)return;if(l===a[t.id])return;if((a._||(a._={}))[t.id]===i)return;a._[t.id]=i}!function(t,e){var o=t.root.gun.get(e)._;if(t.ack&&(o.on("out",{get:{"#":e}}),!t.ask))return;m(t.ask||t.next,function(t,n){t.on("out",{get:{"#":e,".":n}})}),n.obj.del(t,"ask")}(t,u.rel=i)}}}function u(t,n,e){t.echo&&(t.has&&(n=v(n,{event:e})),m(t.echo,a,n))}function a(t){t.on("in",this)}function s(t,e){var o,r,i=this.cat.next||p,u=this.at;(_!==e||i[e])&&(r=i[e])&&(r.has?(t&&t[y]&&n.val.rel.is(t)===n.node.soul(r.put)||(r.put=t),o=r.gun):o=u.gun.get(e),r.on("in",{put:t,get:e,gun:o,via:u}))}function f(t,e){if(t.has||t.soul){var o=t.map,r=t.root;t.map=null,(r.now&&r.now[t.id]||e["@"]||null!==o)&&(l===o&&n.val.rel.is(t.put)||(m(o,function(n){(n=n.at)&&d(n.echo,t.id)}),m(t.next,function(t,n){t.put=l,t.ack&&(t.ack=-1),t.on("in",{get:n,gun:t.gun,put:l})})))}}function c(t,e){var o=this.as,r=o.get||p,i=o.gun._,u=(t.put||p)[r["#"]];if(i.ack&&(i.ack=i.ack+1||1),!t.put||r["."]&&!g(u,i.get)){if(i.put!==l)return;i.on("in",{get:i.get,put:i.put=l,gun:i.gun,"@":t["@"]})}else _!=r["."]?(t.gun=i.root.gun,n.on.put(t,i.root.gun)):i.on("in",{get:i.get,put:u[i.get],gun:i.gun,"@":t["@"]})}n.chain.chain=function(t){var r,i=this._,u=new(t||this).constructor(this),a=u._;return a.root=r=i.root,a.id=++r.once,a.back=this._,a.on=n.on,a.on("in",o,a),a.on("out",e,a),u};var l,p={},h=n.obj,g=h.has,d=(h.put,h.del),v=h.to,m=h.map,b=n.text.random,y=n.val.rel._,_=n.node._})(i,"./chain"),i(function(t){var n=i("./root");function e(t){var n,e=this,i=e.as,u=t.gun._,s=u.root,f=t.put;if((n=s.now)&&e!==n[i.now])return e.to.next(t);o===f&&(f=u.put),(n=f)&&n[a._]&&(n=a.is(n))&&(n=u.root.gun.get(n)._,o!==n.put&&(t=r(t,{put:n.put}))),i.use(t,t.event||e),e.to.next(t)}n.chain.get=function(t,o,r){var i;if("string"!=typeof t){if(t instanceof Function){var f,c=(i=this)._,l=c.root,p=l.now;return(r=o||{}).use=t,r.out=r.out||{},r.out.get=r.out.get||{},f=c.on("in",e,r),(l.now={$:1})[r.now=c.id]=f,c.on("out",r.out),l.now=p,i}return u(t)?this.get(""+t,o,r):(p=a.is(t))?this.get(p,o,r):((r=this.chain())._.err={err:n.log("Invalid get request!",t)},o&&o.call(r,r._.err),r)}var h=this._;return(i=(h.next||s)[t])||(i=function(t,n){var e=n._,o=e.next,r=n.chain()._;o||(o=e.next={});o[r.get=t]=r,n===e.root.gun?r.soul=t:(e.soul||e.has)&&(r.has=t);return r}(t,this)),i=i.gun,(p=h.stun)&&(i._.stun=i._.stun||p),o&&o instanceof Function&&i.get(o,r),i};n.obj.has;var o,r=n.obj.to,u=n.num.is,a=n.val.rel,s=(n.node._,{})})(i,"./get"),i(function(t){var n=i("./root");function o(t){t&&t()}function u(){var t=this;t.graph&&!v(t.stun,a)&&(t.res=t.res||function(t){t&&t()},t.res(function(){var n=t.gun.back(-1)._,e=n.ask(function(e){n.root.on("ack",e),this.off(),t.ack&&t.ack(e,this)},t.opt),o=n.root.now;h.del(n.root,"now"),n.root.PUT=!0;var r=n.root.stop;t.ref._.now=!0,t.ref._.on("out",{gun:t.ref,put:t.out=t.env.graph,opt:t.opt,"#":e}),h.del(t.ref._,"now"),h.del(n.root,"PUT"),n.root.now=o,n.root.stop=r},t),t.res&&t.res())}function a(t,n){if(t)return!0}function s(t,e,o,r){var i=this;!e&&r.path.length&&(i.res||y)(function(){for(var t=r.path,e=i.ref,o=(i.opt,0),u=t.length;o<u;o++)e=e.get(t[o]);if(n.node.soul(r.obj)){var a=n.node.soul(r.obj)||(i.via.back("opt.uuid")||n.text.random)();return a?(e.back(-1).get(a),void r.soul(a)):((i.stun=i.stun||{})[t]=!0,void i.via.back("opt.uuid")(function(o,u){if(o)return n.log(o);e.back(-1).get(u),r.soul(u),i.stun[t]=!1,i.batch()}))}(i.stun=i.stun||{})[t]=!0,e.get("_").get(f,{as:{at:r,as:i}})},{as:i,at:r})}function f(t,e){var o=this.as,r=o.at;if(o=o.as,t.gun&&t.gun._.back){var i=t.gun._,u=i,a=(t.put||m)["#"];e.off(),i=t.gun._.back;var s=s||n.node.soul(r.obj)||n.node.soul(i.put)||n.val.rel.is(i.put)||a||u._id||(o.via.back("opt.uuid")||n.text.random)();s?c(i,u._id=u._id||s,r,o):i.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);c(i,u._id=u._id||e,r,o)})}}function c(t,n,e,o){t.gun.back(-1).get(n),e.soul(n),o.stun[e.path]=!1,o.batch()}function l(t,e){var o=this.as;if(t.gun&&t.gun._)if(t.err)r.log("Please report this as an issue! Put.any.err");else{var i,u=t.gun._.back,a=u.put,s=o.opt||{};if(!(i=o.ref)||!i._.now){if(e.off(),o.ref!==o.gun){if(!(i=o.gun._.get||u.get))return void r.log("Please report this as an issue! Put.no.get");o.data=d({},i,o.data),i=null}if(p===a){if(!u.get)return;u.soul||(i=u.gun.back(function(t){if(t.soul)return t.soul;o.data=d({},t.get,o.data)})),i=i||u.get,u=u.root.gun.get(i)._,o.not=o.soul=i,a=o.data}o.not||(o.soul=n.node.soul(a))||(o.path&&g(o.data)?o.soul=(s.uuid||o.via.back("opt.uuid")||n.text.random)():(_==t.get&&(o.soul=(t.put||m)["#"]||t._id),o.soul=o.soul||t.soul||u.soul||(s.uuid||o.via.back("opt.uuid")||n.text.random)()),o.soul)?o.ref.put(o.data,o.soul,o):o.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);o.ref.put(o.data,o.soul=e,o)})}}}n.chain.put=function(t,r,i){var a,f=this,c=f._,p=c.root.gun;return(i=i||{}).data=t,i.via=i.gun=i.via||i.gun||f,"string"==typeof r?i.soul=r:i.ack=i.ack||r,c.soul&&(i.soul=c.soul),i.soul||p===f?g(i.data)?(i.soul=i.soul||(i.not=n.node.soul(i.data)||(i.via.back("opt.uuid")||n.text.random)()),i.soul?(i.gun=f=p.get(i.soul),i.ref=i.gun,function(t){t.batch=u;var e=t.opt||{},o=t.env=n.state.map(s,e.state);if(o.soul=t.soul,t.graph=n.graph.ify(t.data,o,t),o.err)return(t.ack||b).call(t,t.out={err:n.log(o.err)}),void(t.res&&t.res());t.batch()}(i),f):(i.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);(i.ref||i.gun).put(i.data,i.soul=e,i)}),f)):((i.ack||b).call(i,i.out={err:n.log("Data saved to the root level of the graph must be a node (an object), not a",e(i.data),'of "'+i.data+'"!')}),i.res&&i.res(),f):n.is(t)?(t.get("_").get(function(t,o,u){if(o.off(),!(u=t.gun)||!(u=u._.back)||!u.soul)return n.log("The reference you are saving is a",e(t.put),'"'+i.put+'", not a node (object)!');f.put(n.val.rel.ify(u.soul),r,i)}),f):(i.ref=i.ref||p._===(a=c.back)?f:a.gun,i.ref._.soul&&n.val.is(i.data)&&c.get?(i.data=d({},c.get,i.data),i.ref.put(i.data,i.soul,i),f):(i.ref.get("_").get(l,{as:i}),i.out||(i.res=i.res||o,i.gun._.stun=i.ref._.stun),f))};var p,h=n.obj,g=h.is,d=h.put,v=h.map,m={},b=function(){},y=function(t,n){t.call(n||m)},_=n.node._})(i,"./put"),i(function(t){var n=i("./root");i("./chain"),i("./back"),i("./put"),i("./get"),t.exports=n})(i,"./index"),i(function(t){var n=i("./index");function e(t,e){var o=t.gun,i=o._,u=i.put||t.put,a=this.last,s=i.id+t.get;if(r!==u){if(u&&u[f._]&&(a=f.is(u))){if(a=i.root.gun.get(a)._,r===a.put)return;u=a.put}this.change&&(u=t.put),(a.put!==u||a.get!==s||n.node.soul(u))&&(a.put=u,a.get=s,i.last=u,this.as?this.ok.call(this.as,t,e):this.ok.call(o,u,t.get,t,e))}}function o(t,e,i){var u,a=this.as,s=a.cat,c=t.gun._,l=c.put||t.put;if(u=n.node.soul(l)||f.is(l)){if(u=s.root.gun.get(u)._,r===u.put)return;l=u.put}if(e.wait&&clearTimeout(e.wait),i){if(s.has||s.soul){if(e.off())return}else{if((a.seen=a.seen||{})[c.id])return;a.seen[c.id]=!0}a.ok.call(t.gun||a.gun,l,t.get)}else e.wait=setTimeout(function(){o.call({as:a},t,e,e.wait||1)},a.wait||99)}n.chain.on=function(t,n,o,r){var i,u,a=this._;if("string"==typeof t)return n?(i=a.on(t,n,o||a,r),o&&o.gun&&(o.subs||(o.subs=[])).push(i),(u=function(){i&&i.off&&i.off(),u.off()}).off=this.off.bind(this)||c,this.off=u,this):a.on(t);var s=n;return(s=!0===s?{change:!0}:s||{}).ok=t,s.last={},this.get(e,s),this},n.chain.val=function(t,e){return n.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,e)},n.chain.once=function(t,e){var i=this,u=i._,a=u.put;if(0<u.ack&&r!==a)return(t||c).call(i,a,u.get),i;if(!t){n.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var s=i.chain();return s._.val=i.once(function(){s._.on("in",i._)}),s}return(e=e||{}).ok=t,e.cat=u,e.out={"#":n.text.random(9)},i.get(o,{as:e}),e.async=!0,i},n.chain.off=function(){var t,n=this._,e=n.back;if(e)return(t=e.next)&&t[n.get]&&s(t,n.get),(t=e.ask)&&s(t,n.get),(t=e.put)&&s(t,n.get),(t=n.soul)&&s(e.root.graph,t),(t=n.map)&&a(t,function(t){t.rel&&e.root.gun.get(t.rel).off()}),(t=n.next)&&a(t,function(t){t.gun.off()}),n.on("off",{}),this};var r,u=n.obj,a=u.map,s=(u.has,u.del),f=(u.to,n.val.rel),c=function(){}})(i,"./on"),i(function(t){var n=i("./index");function e(t){t.put&&!n.val.is(t.put)&&(this.as.val&&this.off(),r(t.put,o,{at:this.as,msg:t}),this.to.next(t))}function o(t,n){if(a!==n){var e=this.msg.gun,o=this.at,r=e.get(n)._;(r.echo||(r.echo={}))[o.id]=o}}n.chain.map=function(t,o,r){var i,a=this._;return t?(n.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),i=this.chain(),this.map().on(function(e,o,r,a){var s=(t||u).call(this,e,o,r,a);void 0!==s&&(n.is(s)?i._.on("in",s._):i._.on("in",{get:o,put:s,gun:i}))}),i):(i=a.fields)?i:((i=a.fields=this.chain())._.val=this.back("val"),i._.MAPOF=a.soul,this.on("in",e,i._),i)};var r=n.obj.map,u=function(){},a=n.node._})(i,"./map"),i(function(t){var n=i("./index");n.chain.set=function(t,e,o){var r,i=this;if(e=e||function(){},(o=o||{}).item=o.item||t,r=n.node.soul(t))return i.set(i.back(-1).get(r),e,o);if(!n.is(t)){var u=i.back("opt.uuid")();return u&&n.obj.is(t)?i.set(i._.root.gun.put(t,u),e,o):i.get(n.state.lex()+n.text.random(7)).put(t,e,o)}return t.get("_").get(function(t,r){if(t.gun&&t.gun._.back){r.off();var u=(t.put||{})["#"],a=(t=t.gun._.back).put;if(!(u=t.soul||n.node.soul(a)||u))return e.call(i,{err:n.log('Only a node can be linked! Not "'+a+'"!')});i.put(n.obj.put({},u,n.val.rel.ify(u)),e,o)}},{wait:0}),t}})(i,"./set"),i(function(t){if("undefined"!=typeof Gun){var n,e=function(){};"undefined"!=typeof window&&(n=window);var o=n.localStorage||{setItem:e,removeItem:e,getItem:e};Gun.on("create",function(t){var n=this.to,e=t.opt;if(t.once)return n.next(t);if(!1===e.localStorage)return n.next(t);e.file=e.file||"gun/";var r,i,u=Gun.obj.ify(o.getItem("gap/"+e.file))||{},a=Gun.obj.empty;function s(t){if(!t.err&&t.ok){var n=t["@"];setTimeout(function(){Gun.obj.map(u,function(t,e){Gun.obj.map(t,function(e,o){n===e&&delete t[o]}),a(t)&&delete u[e]}),c()},e.wait||1)}}a(u)||t.on("localStorage",function(n){this.off();var e={};Gun.obj.map(u,function(t,o){Gun.obj.map(t,function(t,r){e[o]=Gun.state.to(n[o],r,e[o])})}),setTimeout(function(){t.on("out",{put:e,"#":t.ask(s),I:t.gun})},10)}),t.on("out",function(t){t.lS||(t.I&&t.put&&!t["@"]&&!a(e.peers)&&(r=t["#"],Gun.graph.is(t.put,null,f),i||(i=setTimeout(c,e.wait||1))),this.to.next(t))}),t.on("ack",s),n.next(t);var f=function(t,n,e,o){(u[o]||(u[o]={}))[n]=r},c=function(){clearTimeout(i),i=!1;try{o.setItem("gap/"+e.file,JSON.stringify(u))}catch(t){Gun.log(err=t||"localStorage failure")}}}),Gun.on("create",function(t){this.to.next(t);var n=t.opt;if(!t.once&&!1!==n.localStorage){n.file=n.file||n.prefix||"gun/";t.graph;var e,r={},i=0,u=Gun.obj.ify(o.getItem(n.file))||{};t.on("localStorage",u),t.on("put",function(t){if(this.to.next(t),Gun.graph.is(t.put,null,a),t["@"]||(r[t["#"]]=!0),(i+=1)>=(n.batch||1e3))return s();e||(e=setTimeout(s,n.wait||1))}),t.on("get",function(e){this.to.next(e);var o,r,i=e.get;if(i&&(o=i["#"])){var a=i["."];(r=u[o]||void 0)&&a&&(r=Gun.state.to(r,a)),(r||Gun.obj.empty(n.peers))&&t.on("in",{"@":e["#"],put:Gun.graph.node(r),how:"lS",lS:e.I})}});var a=function(t,n,e,o){u[o]=Gun.state.to(e,n,u[o])},s=function a(s){var f;i=0,clearTimeout(e),e=!1;var c=r;r={},s&&(u=s);try{o.setItem(n.file,JSON.stringify(u))}catch(e){Gun.log(f=e||"localStorage failure"),t.on("localStorage:error",{err:f,file:n.file,flush:u,retry:a})}(f||Gun.obj.empty(n.peers))&&Gun.obj.map(c,function(n,e){t.on("in",{"@":e,err:f,ok:0})})}}})}})(i,"./adapters/localStorage"),i(function(t){var n=i("../type");function e(t){var i=function(){};return i.out=function(n){var e;if(this.to&&this.to.next(n),(e=n["@"])&&(e=t.dup.s[e])&&(e=e.it)&&e.mesh)return i.say(n,e.mesh.via),void(e["##"]=n["##"]);i.say(n)},i.hear=function(e,o){if(e){var r,u,a,s=t.dup,f=e[0];try{a=JSON.parse(e)}catch(t){}if("{"===f){if(!a)return;if(s.check(r=a["#"]))return;if(s.track(r,!0).it=a,(f=a["@"])&&a.put&&(f+=u=a["##"]||(a["##"]=i.hash(a)))!=r){if(s.check(f))return;(f=s.s)[u]=f[r]}return(a.mesh=function(){}).via=o,(f=a["><"])&&(a.mesh.to=n.obj.map(f.split(","),function(t,n,e){e(t,!0)})),void t.on("in",a)}if("["!==f);else{if(!a)return;for(var c,l=0;c=a[l++];)i.hear(c,o)}}},function(){function e(t,n){var e=n.wire;try{e.send?e.readyState===e.OPEN?e.send(t):(n.queue=n.queue||[]).push(t):n.say&&n.say(t)}catch(e){(n.queue=n.queue||[]).push(t)}}i.say=function(o,u){var a,s,f;u?(u.wire||t.opt.wire&&t.opt.wire(u))&&(s=o.mesh||r,u!==s.via&&((f=s.raw)||(f=i.raw(o)),(a=o["@"])&&(a=t.dup.s[a])&&(a=a.it)&&a.get&&a["##"]&&a["##"]===o["##"]||(a=s.to)&&(a[u.url]||a[u.id])||(u.batch?u.batch.push(f):(u.batch=[],setTimeout(function(){var t=u.batch;t&&(u.batch=null,t.length&&e(JSON.stringify(t),u))},t.opt.gap||t.opt.wait||1),e(f,u))))):n.obj.map(t.opt.peers,function(t){i.say(o,t)})}}(),function(){function r(t,e){var o;return e instanceof Object?(n.obj.map(Object.keys(e).sort(),u,{to:o={},on:e}),o):e}function u(t){this.to[t]=this.on[t]}i.raw=function(e){if(!e)return"";var u,f,c,l=t.dup,p=e.mesh||{};if(c=p.raw)return c;if("string"==typeof e)return e;e["@"]&&(c=e.put)&&((f=e["##"])||(u=a(c,r)||"",f=i.hash(e,u),e["##"]=f),(c=l.s)[f=e["@"]+f]=c[e["#"]],e["#"]=f||e["#"],u&&((e=n.obj.to(e)).put=s));var h=0,g=[];n.obj.map(t.opt.peers,function(t){if(g.push(t.url||t.id),++h>9)return!0}),e["><"]=g.join();var d=a(e);return o!==u&&(d=d.replace('"'+s+'"',u)),p&&(p.raw=d),d},i.hash=function(t,o){return e.hash(o||a(t.put,r)||"")||t["#"]||n.text.random(9)};var a=JSON.stringify,s=":])([:"}(),i.hi=function(e){t.on("hi",e);var o=e.queue;e.queue=[],n.obj.map(o,function(t){i.say(t,e)})},i}e.hash=function(t){if("string"!=typeof t)return{err:1};var n=0;if(!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n};var o,r={};Object.keys=Object.keys||function(t){return map(t,function(t,n,e){e(n)})};try{t.exports=e}catch(t){}})(i,"./adapters/mesh"),i(function(n){var e=i("../index");e.Mesh=i("./mesh"),e.on("opt",function(n){this.to.next(n);var o=n.opt;if(!n.once&&!1!==o.WebSocket){var r;"undefined"!=typeof window&&(r=window),void 0!==t&&(r=t),r=r||{};var i=o.WebSocket||r.WebSocket||r.webkitWebSocket||r.mozWebSocket;if(i){o.WebSocket=i;var u=o.mesh=o.mesh||e.Mesh(n);n.on("create",function(t){this.to.next(t),n.on("out",u.out)}),o.wire=o.wire||a}}function a(t){if(t&&t.url){var e=t.url.replace("http","ws"),i=t.wire=new o.WebSocket(e);return i.onclose=function(){n.on("bye",t),s(t)},i.onerror=function(n){s(t),n&&n.code},i.onopen=function(){u.hi(t)},i.onmessage=function(n){n&&(r.inLength=(r.inLength||0)+(n.data||n).length,u.hear(n.data||n,t))},i}}function s(t){clearTimeout(t.defer),t.defer=setTimeout(function(){a(t)},2e3)}})})(i,"./adapters/websocket")}()}).call(this,e(0),e(3)(t))},function(t,n,e){"use strict";var o=e(2),r=e(4);t.exports=o(r)},function(t,n,e){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function u(t){return"object"===(void 0===t?"undefined":o(t))&&null!==t}function a(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var n,e,o,r,s,f;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((n=arguments[1])instanceof Error)throw n;var c=new Error('Uncaught, unspecified "error" event. ('+n+")");throw c.context=n,c}if(a(e=this._events[t]))return!1;if(i(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),e.apply(this,r)}else if(u(e))for(r=Array.prototype.slice.call(arguments,1),o=(f=e.slice()).length,s=0;s<o;s++)f[s].apply(this,r);return!0},r.prototype.addListener=function(t,n){var e;if(!i(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(n.listener)?n.listener:n),this._events[t]?u(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,u(this._events[t])&&!this._events[t].warned&&(e=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&e>0&&this._events[t].length>e&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,n){if(!i(n))throw TypeError("listener must be a function");var e=!1;function o(){this.removeListener(t,o),e||(e=!0,n.apply(this,arguments))}return o.listener=n,this.on(t,o),this},r.prototype.removeListener=function(t,n){var e,o,r,a;if(!i(n))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=(e=this._events[t]).length,o=-1,e===n||i(e.listener)&&e.listener===n)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,n);else if(u(e)){for(a=r;a-- >0;)if(e[a]===n||e[a].listener&&e[a].listener===n){o=a;break}if(o<0)return this;1===e.length?(e.length=0,delete this._events[t]):e.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,n)}return this},r.prototype.removeAllListeners=function(t){var n,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(i(e=this._events[t]))this.removeListener(t,e);else if(e)for(;e.length;)this.removeListener(t,e[e.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var n=this._events[t];if(i(n))return 1;if(n)return n.length}return 0},r.listenerCount=function(t,n){return t.listenerCount(n)}},function(t,n,e){"use strict";"function"==typeof Object.create?t.exports=function(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,n){t.super_=n;var e=function(){};e.prototype=n.prototype,t.prototype=new e,t.prototype.constructor=t}},function(t,n,e){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){return t&&"object"===(void 0===t?"undefined":o(t))&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,n,e){"use strict";(function(t,o){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=/%[sdj%]/g;n.format=function(t){if(!b(t)){for(var n=[],e=0;e<arguments.length;e++)n.push(s(arguments[e]));return n.join(" ")}e=1;for(var o=arguments,r=o.length,u=String(t).replace(i,function(t){if("%%"===t)return"%";if(e>=r)return t;switch(t){case"%s":return String(o[e++]);case"%d":return Number(o[e++]);case"%j":try{return JSON.stringify(o[e++])}catch(t){return"[Circular]"}default:return t}}),a=o[e];e<r;a=o[++e])v(a)||!k(a)?u+=" "+a:u+=" "+s(a);return u},n.deprecate=function(e,r){if(y(t.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(!0===o.noDeprecation)return e;var i=!1;return function(){if(!i){if(o.throwDeprecation)throw new Error(r);o.traceDeprecation?console.trace(r):console.error(r),i=!0}return e.apply(this,arguments)}};var u,a={};function s(t,e){var o={seen:[],stylize:c};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),d(e)?o.showHidden=e:e&&n._extend(o,e),y(o.showHidden)&&(o.showHidden=!1),y(o.depth)&&(o.depth=2),y(o.colors)&&(o.colors=!1),y(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=f),l(o,t,o.depth)}function f(t,n){var e=s.styles[n];return e?"["+s.colors[e][0]+"m"+t+"["+s.colors[e][1]+"m":t}function c(t,n){return t}function l(t,e,o){if(t.customInspect&&e&&j(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(o,t);return b(r)||(r=l(t,r,o)),r}var i=function(t,n){if(y(n))return t.stylize("undefined","undefined");if(b(n)){var e="'"+JSON.stringify(n).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(e,"string")}if(m(n))return t.stylize(""+n,"number");if(d(n))return t.stylize(""+n,"boolean");if(v(n))return t.stylize("null","null")}(t,e);if(i)return i;var u=Object.keys(e),a=function(t){var n={};return t.forEach(function(t,e){n[t]=!0}),n}(u);if(t.showHidden&&(u=Object.getOwnPropertyNames(e)),w(e)&&(u.indexOf("message")>=0||u.indexOf("description")>=0))return p(e);if(0===u.length){if(j(e)){var s=e.name?": "+e.name:"";return t.stylize("[Function"+s+"]","special")}if(_(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(x(e))return t.stylize(Date.prototype.toString.call(e),"date");if(w(e))return p(e)}var f,c="",k=!1,S=["{","}"];(g(e)&&(k=!0,S=["[","]"]),j(e))&&(c=" [Function"+(e.name?": "+e.name:"")+"]");return _(e)&&(c=" "+RegExp.prototype.toString.call(e)),x(e)&&(c=" "+Date.prototype.toUTCString.call(e)),w(e)&&(c=" "+p(e)),0!==u.length||k&&0!=e.length?o<0?_(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),f=k?function(t,n,e,o,r){for(var i=[],u=0,a=n.length;u<a;++u)N(n,String(u))?i.push(h(t,n,e,o,String(u),!0)):i.push("");return r.forEach(function(r){r.match(/^\d+$/)||i.push(h(t,n,e,o,r,!0))}),i}(t,e,o,a,u):u.map(function(n){return h(t,e,o,a,n,k)}),t.seen.pop(),function(t,n,e){if(t.reduce(function(t,n){return 0,n.indexOf("\n")>=0&&0,t+n.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return e[0]+(""===n?"":n+"\n ")+" "+t.join(",\n  ")+" "+e[1];return e[0]+n+" "+t.join(", ")+" "+e[1]}(f,c,S)):S[0]+c+S[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,n,e,o,r,i){var u,a,s;if((s=Object.getOwnPropertyDescriptor(n,r)||{value:n[r]}).get?a=s.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):s.set&&(a=t.stylize("[Setter]","special")),N(o,r)||(u="["+r+"]"),a||(t.seen.indexOf(s.value)<0?(a=v(e)?l(t,s.value,null):l(t,s.value,e-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),y(u)){if(i&&r.match(/^\d+$/))return a;(u=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=t.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=t.stylize(u,"string"))}return u+": "+a}function g(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function v(t){return null===t}function m(t){return"number"==typeof t}function b(t){return"string"==typeof t}function y(t){return void 0===t}function _(t){return k(t)&&"[object RegExp]"===S(t)}function k(t){return"object"===(void 0===t?"undefined":r(t))&&null!==t}function x(t){return k(t)&&"[object Date]"===S(t)}function w(t){return k(t)&&("[object Error]"===S(t)||t instanceof Error)}function j(t){return"function"==typeof t}function S(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}n.debuglog=function(t){if(y(u)&&(u=o.env.NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(u)){var e=o.pid;a[t]=function(){var o=n.format.apply(n,arguments);console.error("%s %d: %s",t,e,o)}}else a[t]=function(){};return a[t]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=g,n.isBoolean=d,n.isNull=v,n.isNullOrUndefined=function(t){return null==t},n.isNumber=m,n.isString=b,n.isSymbol=function(t){return"symbol"===(void 0===t?"undefined":r(t))},n.isUndefined=y,n.isRegExp=_,n.isObject=k,n.isDate=x,n.isError=w,n.isFunction=j,n.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===(void 0===t?"undefined":r(t))||void 0===t},n.isBuffer=e(8);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(t,n){return Object.prototype.hasOwnProperty.call(t,n)}n.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[O(t.getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":"),[t.getDate(),T[t.getMonth()],e].join(" ")),n.format.apply(n,arguments))},n.inherits=e(7),n._extend=function(t,n){if(!n||!k(n))return t;for(var e=Object.keys(n),o=e.length;o--;)t[e[o]]=n[e[o]];return t}}).call(this,e(0),e(1))},function(t,n,e){"use strict";(function(t,n){var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var o;"undefined"!=typeof window&&(o=window),void 0!==t&&(o=t);var r=(o=o||{}).console||{log:function(){}};function i(t){return t.slice?i[n(t)]:function(e,o){t(e={exports:{}}),i[n(o)]=e.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}var u=n;i(function(t){var n={};n.fns=n.fn={is:function(t){return!!t&&"function"==typeof t}},n.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},n.num={is:function(t){return!o(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},n.text={is:function(t){return"string"==typeof t}},n.text.ify=function(t){return n.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},n.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},n.text.match=function(t,e){var o=!1;if(t=t||"",e=n.text.is(e)?{"=":e}:e||{},n.obj.has(e,"~")&&(t=t.toLowerCase(),e["="]=(e["="]||e["~"]).toLowerCase()),n.obj.has(e,"="))return t===e["="];if(n.obj.has(e,"*")){if(t.slice(0,e["*"].length)!==e["*"])return!1;o=!0,t=t.slice(e["*"].length)}if(n.obj.has(e,"!")){if(t.slice(-e["!"].length)!==e["!"])return!1;o=!0}if(n.obj.has(e,"+")&&n.list.map(n.list.is(e["+"])?e["+"]:[e["+"]],function(n){if(!(0<=t.indexOf(n)))return!0;o=!0}))return!1;if(n.obj.has(e,"-")&&n.list.map(n.list.is(e["-"])?e["-"]:[e["-"]],function(n){if(!(t.indexOf(n)<0))return!0;o=!0}))return!1;if(n.obj.has(e,">")){if(!(t>e[">"]))return!1;o=!0}if(n.obj.has(e,"<")){if(!(t<e["<"]))return!1;o=!0}if(n.obj.has(e,"?")){if(!function(t,n){for(var e,o=-1,r=0;e=n[r++];)if(!~(o=t.indexOf(e,o+1)))return!1;return!0}(t,e["?"]))return!1;o=!0}return o},n.list={is:function(t){return t instanceof Array}},n.list.slit=Array.prototype.slice,n.list.sort=function(t){return function(n,e){return n&&e?(n=n[t])<(e=e[t])?-1:e<n?1:0:0}},n.list.map=function(t,n,e){return a(t,n,e)},n.list.index=1,n.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=function(t,n,e){return(t||{})[n]=e,t},n.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},n.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},n.obj.ify=function(t){if(i(t))return t;try{t=JSON.parse(t)}catch(n){t={}}return t},function(){function t(t,n){u(this,n)&&void 0!==this[n]||(this[n]=t)}n.obj.to=function(n,e){return a(n,t,e=e||{}),e}}(),n.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function t(t,n){var e=this.n;if(!e||!(n===e||i(e)&&u(e,n)))return!!n||void 0}n.obj.empty=function(n,e){return!n||!a(n,t,{n:e})}}(),function(){function t(n,e){2!==arguments.length?(t.r=t.r||[]).push(n):(t.r=t.r||{})[n]=e}var r=Object.keys;n.obj.map=function(a,s,f){var c,l,p,h,g=0,d=e(s);if(t.r=null,r&&i(a)&&(p=r(a),h=!0),o(a)||p)for(c=(p||a).length;g<c;g++){var v=g+n.list.index;if(d){if(void 0!==(l=h?s.call(f||this,a[p[g]],p[g],t):s.call(f||this,a[g],v,t)))return l}else if(s===a[h?p[g]:g])return p?p[g]:v}else for(g in a)if(d){if(u(a,g)&&void 0!==(l=f?s.call(f,a[g],g,t):s(a[g],g,t)))return l}else if(s===a[g])return g;return d?t.r:n.list.index?0:-1}}(),n.time={},n.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};var e=n.fn.is,o=n.list.is,r=n.obj,i=r.is,u=r.has,a=r.map;t.exports=n})(i,"./type"),i(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};if(n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}}),e instanceof Function){var r={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(r.back=n.last||n).to=r,n.last=r}return(n=n.to)&&void 0!==e&&n.next(e),n}})(i,"./onto"),i(function(t){if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var n=JSON.stringify;t.exports=function(t,e,o,r,i){if(t<e)return{defer:!0};if(e<o)return{historical:!0};if(o<e)return{converge:!0,incoming:!0};if(e===o){if((r=n(r)||"")===(i=n(i)||""))return{state:!0};if(r<i)return{converge:!0,current:!0};if(i<r)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+r+" to "+i+" at "+e+" to "+o+"!"}}})(i,"./HAM"),i(function(t){var n=i("./type"),e={is:function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(a(t)||r(t)||u(t))||e.rel.is(t)||!1))},rel:{_:"#"}};(function(){function t(t,n){return this.id?this.id=!1:n==o&&a(t)?void(this.id=t):this.id=!1}e.rel.is=function(n){if(n&&n[o]&&!n._&&f(n)){var e={};if(l(n,t,e),e.id)return e.id}return!1}})(),e.rel.ify=function(t){return c({},o,t)},n.obj.has._=".";var o=e.rel._,r=n.bi.is,u=n.num.is,a=n.text.is,s=n.obj,f=s.is,c=s.put,l=s.map;t.exports=e})(i,"./val"),i(function(t){var n=i("./type"),e=i("./val"),o={_:"_",soul:function(t,n){return t&&t._&&t._[n||c]}};o.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[c]=n.soul||t._[c]||f(),t},o.soul._=e.rel._,function(){function t(t,n){if(n!==o._)return!e.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}o.is=function(n,e,r){var i;return!!u(n)&&!!(i=o.soul(n))&&!s(n,t,{as:r,cb:e,s:i,n:n})}}(),function(){function t(t,n){var o,r=this.o;r.map?void 0===(o=r.map.call(this.as,t,""+n,r.node))?a(r.node,n):r.node&&(r.node[n]=o):e.is(t)&&(r.node[n]=t)}o.ify=function(n,e,r){return e?"string"==typeof e?e={soul:e}:e instanceof Function&&(e={map:e}):e={},e.map&&(e.node=e.map.call(r,n,void 0,e.node||{})),(e.node=o.soul.ify(e.node||{},e))&&s(n,t,{o:e,as:r}),e.node}}();var r=n.obj,u=r.is,a=r.del,s=r.map,f=n.text.random,c=o.soul._;t.exports=o})(i,"./node"),i(function(t){var n=i("./type"),e=i("./node");function o(){var t;return t=r(),u<t?(a=0,u=t+o.drift):u=t+(a+=1)/s+o.drift}var r=n.time.is,u=-1/0,a=0,s=1e3,f="undefined"!=typeof performance&&performance.timing&&performance;f&&f.timing&&f.timing.navigationStart||(f=!1),o._=">",o.drift=0,o.is=function(t,n,e){var r=n&&t&&t[b]&&t[b][o._]||e;if(r)return v(r=r[n])?r:-1/0},o.lex=function(){return o().toString(36).replace(".","")},o.ify=function(t,n,r,i,u){if(!t||!t[b]){if(!u)return;t=e.soul.ify(t,u)}var a=l(t[b],o._);return void 0!==n&&n!==b&&(v(r)&&(a[n]=r),void 0!==i&&(t[n]=i)),t},o.to=function(t,n,r){var i=t[n];return h(i)&&(i=d(i)),o.ify(r,n,o.is(t,n),i,e.soul(t))},function(){function t(t,n){b!==n&&o.ify(this.o,n,this.s)}o.map=function(n,e,r){var i=h(i=n||e)?i:null;return n=m(n=n||e)?n:null,i&&!n?(e=v(e)?e:o(),i[b]=i[b]||{},g(i,t,{o:i,s:e}),i):(r=r||h(e)?e:void 0,e=v(e)?e:o(),function(o,i,u,a){if(!n)return t.call({o:u,s:e},o,i),o;n.call(r||this||{},o,i,u,a),p(u,i)&&void 0===u[i]||t.call({o:u,s:e},o,i)})}}();var c=n.obj,l=c.as,p=c.has,h=c.is,g=c.map,d=c.copy,v=n.num.is,m=n.fn.is,b=e._;t.exports=o})(i,"./state"),i(function(t){var n=i("./type"),e=i("./val"),o=i("./node"),r={};!function(){function t(t,e){if(!t||e!==o.soul(t)||!o.is(t,this.fn,this.as))return!0;this.cb&&(n.n=t,n.as=this.as,this.cb.call(n.as,t,e,n))}function n(t){t&&o.is(n.n,t,n.as)}r.is=function(n,e,o,r){return!(!n||!a(n)||c(n)||p(n,t,{cb:e,fn:o,as:r}))}}(),function(){function t(t,n){var r;return(r=function(t,n){for(var e,o=t.seen,r=o.length;r--;)if(e=o[r],n.obj===e.obj)return e;o.push(n)}(t,n))?r:(n.env=t,n.soul=u,o.ify(n.obj,i,n)&&(t.graph[e.rel.is(n.rel)]=n.node),n)}function i(n,r,i){var u,a,l=this,p=l.env;if(o._===r&&f(n,e.rel._))return i._;if(u=c(n,r,i,l,p)){if(r||(l.node=l.node||i||{},f(n,o._)&&(l.node._=h(n._)),l.node=o.soul.ify(l.node,e.rel.is(l.rel)),l.rel=l.rel||e.rel.ify(o.soul(l.node))),(a=p.map)&&(a.call(p.as||{},n,r,i,l),f(i,r))){if(void 0===(n=i[r]))return void s(i,r);if(!(u=c(n,r,i,l,p)))return}if(!r)return l.node;if(!0===u)return n;if((a=t(p,{obj:n,path:l.path.concat(r)})).node)return a.rel}}function u(t){var n=this,r=e.rel.is(n.rel),i=n.env.graph;n.rel=n.rel||e.rel.ify(t),n.rel[e.rel._]=t,n.node&&n.node[o._]&&(n.node[o._][e.rel._]=t),f(i,r)&&(i[t]=i[r],s(i,r))}function c(t,o,r,i,u){var s;return!!e.is(t)||(a(t)?1:(s=u.invalid)?c(t=s.call(u.as||{},t,o,r),o,r,i,u):(u.err="Invalid value at '"+i.path.concat(o).join(".")+"'!",void(n.list.is(t)&&(u.err+=" Use `.set(item)` instead of an Array."))))}r.ify=function(n,o,r){var i={path:[],obj:n};return o?"string"==typeof o?o={soul:o}:o instanceof Function&&(o.map=o):o={},o.soul&&(i.rel=e.rel.ify(o.soul)),o.graph=o.graph||{},o.seen=o.seen||[],o.as=o.as||r,t(o,i),o.root=i.node,o.graph}}(),r.node=function(t){var n=o.soul(t);if(n)return l({},n,t)},function(){function t(t,n){var i,u;if(o._!==n)(i=e.rel.is(t))?(u=this.opt.seen[i])?this.obj[n]=u:this.obj[n]=this.opt.seen[i]=r.to(this.graph,i,this.opt):this.obj[n]=t;else{if(c(t,e.rel._))return;this.obj[n]=h(t)}}r.to=function(n,e,o){if(n){var r={};return o=o||{seen:{}},p(n[e],t,{obj:r,graph:n,opt:o}),r}}}(),n.fn.is;var u=n.obj,a=u.is,s=u.del,f=u.has,c=u.empty,l=u.put,p=u.map,h=u.copy;t.exports=r})(i,"./graph"),i(function(t){i("./onto"),t.exports=function(t,n){if(this.on){if(!(t instanceof Function)){if(!t||!n)return;var e=t["#"]||t,o=(this.tag||empty)[e];if(!o)return;return o=this.on(e,n),clearTimeout(o.err),!0}if(e=n&&n["#"]||Math.random().toString(36).slice(2),!t)return e;var r=this.on(e,t,n);return r.err=r.err||setTimeout(function(){r.next({err:"Error: No ACK received yet."}),r.off()},(this.opt||{}).lack||9e3),e}}})(i,"./ask"),i(function(t){var n=i("./type"),e=n.time.is;t.exports=function(t){var o={s:{}};return t=t||{max:1e3,age:9e3},o.check=function(t){var n;return!!(n=o.s[t])&&(n.pass?n.pass=!1:o.track(t))},o.track=function(r,i){var u=o.s[r]||(o.s[r]={});return u.was=e(),i&&(u.pass=!0),o.to||(o.to=setTimeout(function(){var r=e();n.obj.map(o.s,function(e,i){t.age>r-e.was||n.obj.del(o.s,i)}),o.to=null},t.age+9)),u},o}})(i,"./dup"),i(function(t){function n(t){return t instanceof n?(this._={gun:this}).gun:this instanceof n?n.create(this._={gun:this,opt:t}):new n(t)}n.is=function(t){return t instanceof n||t&&t._&&t._.gun&&!0||!1},n.version=.9,(n.chain=n.prototype).toJSON=function(){};var e=i("./type");e.obj.to(e,n),n.HAM=i("./HAM"),n.val=i("./val"),n.node=i("./node"),n.state=i("./state"),n.graph=i("./graph"),n.on=i("./onto"),n.ask=i("./ask"),n.dup=i("./dup"),function(){function t(e){var o,r,i=this.as,u=i.gun;(r=e["#"])||(r=e["#"]=f(9)),(o=i.dup).check(r)?i.out===e.out&&(e.out=void 0,this.to.next(e)):(o.track(r),i.ask(e["@"],e)||(e.get&&n.on.get(e,u),e.put&&n.on.put(e,u)),this.to.next(e),i.out||(e.out=t,i.on("out",e)))}n.create=function(e){e.root=e.root||e,e.graph=e.graph||{},e.on=e.on||n.on,e.ask=e.ask||n.ask,e.dup=e.dup||n.dup();var o=e.gun.opt(e.opt);return e.once||(e.on("in",t,e),e.on("out",t,h(e,{out:t})),n.on("create",e),e.on("create",e)),e.once=1,o}}(),function(){function t(t,e,o,r){var i=this,u=n.state.is(o,e);if(!u)return i.err="Error: No state on '"+e+"' in node '"+r+"'!";var a=i.graph[r]||b,s=n.state.is(a,e,!0),f=a[e],c=n.HAM(i.machine,u,s,t,f);c.incoming?(i.put[r]=n.state.to(o,e,i.put[r]),(i.diff||(i.diff={}))[r]=n.state.to(o,e,i.diff[r]),i.souls[r]=!0):c.defer&&(i.defer=u<(i.defer||1/0)?u:i.defer)}function e(t,n){var e=this,u=e.gun._,a=(u.next||b)[n];if(!a){if(!(u.opt||b).super)return void(e.souls[n]=!1);a=e.gun.get(n)._}var s=e.map[n]={put:t,get:n,gun:a.gun},f={ctx:e,msg:s};e.async=!!u.tag.node,e.ack&&(s["@"]=e.ack),g(t,o,f),e.async&&(e.and||u.on("node",function(t){this.to.next(t),t===e.map[t.get]&&(e.souls[t.get]=!1,g(t.put,r,t),g(e.souls,function(t){if(t)return t})||e.c||(e.c=1,this.off(),u.stop={},g(e.map,i,e)))}),e.and=!0,u.on("node",s))}function o(t,e){var o=this.ctx,r=o.graph,i=this.msg,u=i.get,a=i.put,s=i.gun._;r[u]=n.state.to(a,e,r[u]),o.async||(s.put=n.state.to(a,e,s.put))}function r(t,e){var o=this.put,r=this.gun._;r.put=n.state.to(o,e,r.put)}function i(t,n){t.gun&&t.gun._.on("in",t)}n.on.put=function(o,r){var u=r._,a={gun:r,graph:u.graph,put:{},map:{},souls:{},machine:n.state(),ack:o["@"]};if(n.graph.is(o.put,null,t,a)||(a.err="Error: Invalid graph!"),a.err)return u.on("in",{"@":o["#"],err:n.log(a.err)});g(a.put,e,a),a.async||(u.stop={},g(a.map,i,a)),void 0!==a.defer&&setTimeout(function(){n.on.put(o,r)},a.defer-a.machine),a.diff&&u.on("put",h(o,{put:a.diff}))},n.on.get=function(t,e){var o=e._,r=t.get[v],i=o.graph[r],u=t.get[m],a=(o.next||(o.next={}))[r];if(!i||!a)return o.on("get",t);if(u){if(!p(i,u))return o.on("get",t);i=n.state.to(i,u)}else i=n.obj.copy(i);i=n.graph.node(i),o.on("in",{"@":t["#"],how:"mem",put:i,gun:e}),o.on("get",t)}}(),n.chain.opt=function(t){t=t||{};var e=this._,r=t.peers||t;return l(t)||(t={}),l(e.opt)||(e.opt=t),s(r)&&(r=[r]),o(r)&&(r=g(r,function(t,n,e){e(t,{url:t})}),l(e.opt.peers)||(e.opt.peers={}),e.opt.peers=h(r,e.opt.peers)),e.opt.peers=e.opt.peers||{},h(t,e.opt),n.on("opt",e),e.opt.uuid=e.opt.uuid||function(){return d()+f(12)},this};var o=n.list.is,a=n.text,s=a.is,f=a.random,c=n.obj,l=c.is,p=c.has,h=c.to,g=c.map,d=(c.copy,n.state.lex),v=n.val.rel._,m=".",b=(n.node._,n.val.rel.is,{});r.debug=function(t,n){return r.debug.i&&t===r.debug.i&&r.debug.i++&&(r.log.apply(r,arguments)||n)},(n.log=function(){return!n.log.off&&r.log.apply(r,arguments),[].slice.call(arguments).join(" ")}).once=function(t,e,o){return(o=n.log.once)[t]=o[t]||0,o[t]++||n.log(e)},n.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, feel free to ask for help on https://gitter.im/amark/gun and ask StackOverflow questions tagged with 'gun'!"),"undefined"!=typeof window&&(window.Gun=n);try{void 0!==u&&(u.exports=n)}catch(t){}t.exports=n})(i,"./root"),i(function(t){var n=i("./root");n.chain.back=function(t,o){if(-1===(t=t||1)||1/0===t)return this._.root.gun;if(1===t)return(this._.back||this._).gun;var r=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var i=0,u=t.length,a=r;i<u;i++)a=(a||e)[t[i]];return void 0!==a?o?this:a:(a=r.back)?a.gun.back(t,o):void 0}if(t instanceof Function){var s;for(a={back:r};(a=a.back)&&!(s=t(a,o)););return s}return n.num.is(t)?(r.back||r).gun.back(t-1):this};var e={}})(i,"./back"),i(function(t){var n=i("./root");function e(t){var e,o=this.as,r=o.back,i=o.root;if(t.I||(t.I=o.gun),t.gun||(t.gun=o.gun),this.to.next(t),e=t.get){if(e["#"]||o.soul){if(e["#"]=e["#"]||o.soul,t["#"]||(t["#"]=b(9)),r=i.gun.get(e["#"])._,e=e["."]){if(g(r.put,e))return void r.on("in",{gun:r.gun,put:n.state.to(r.put,e),get:r.get})}else{if(g(r,"put")&&r.on("in",r),r.ack)return;t.gun=r.gun,r.ack=-1}return i.ask(c,t),i.on("in",t)}if(i.now&&(i.now[o.id]=i.now[o.id]||!0),e["."])return o.get?(t={get:{".":o.get},gun:o.gun},(r.ask||(r.ask={}))[o.get]=t.gun._):t={get:{},gun:o.gun},r.on("out",t);if(o.ack=o.ack||-1,o.get)return t.gun=o.gun,e["."]=o.get,(r.ask||(r.ask={}))[o.get]=t.gun._,r.on("out",t)}return r.on("out",t)}function o(t){var e,o=this,i=this.as,a=t.gun._,c=t.put;if(i.get&&t.get!==i.get&&(t=v(t,{get:i.get})),i.has&&a!==i&&(t=v(t,{gun:i.gun}),a.ack&&(i.ack=a.ack)),_===i.get&&c&&c["#"]&&(i._id=c["#"]),l===c){if(o.to.next(t),i.soul)return;return u(i,t,o),i.has&&f(i,t),d(a.echo,i.id),void d(i.map,a.id)}return i.soul?(o.to.next(t),u(i,t,o),void m(c,s,{at:t,cat:i})):(e=n.val.rel.is(c))?(r(i,t,a,e),o.to.next(t),void u(i,t,o)):n.val.is(c)?(i.has||i.soul?f(i,t):(a.has||a.soul)&&((((a.echo||(a.echo={}))[i.id]=i).map||(i.map={}))[a.id]=i.map[a.id]||{at:a}),o.to.next(t),void u(i,t,o)):(i.has&&a!==i&&g(a,"put")&&(i.put=a.put),(e=n.node.soul(c))&&a.has&&(a.put=i.root.gun.get(e)._.put),o.to.next(t),u(i,t,o),r(i,t,a,e),void m(c,s,{at:t,cat:i}))}function r(t,e,o,i){if(i&&_!==t.get){var u=t.root.gun.get(i)._;if(t.has?o=u:o.has&&r(o,e,o,i),o!==t){((o.echo||(o.echo={}))[t.id]=t).has&&!(t.map||p)[o.id]&&f(t,e),u=(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o};var a=t.root.now;if(i===u.rel){if(!a)return;if(l===a[t.id])return;if((a._||(a._={}))[t.id]===i)return;a._[t.id]=i}!function(t,e){var o=t.root.gun.get(e)._;t.ack&&(o.on("out",{get:{"#":e}}),!t.ask)||(m(t.ask||t.next,function(t,n){t.on("out",{get:{"#":e,".":n}})}),n.obj.del(t,"ask"))}(t,u.rel=i)}}}function u(t,n,e){t.echo&&(t.has&&(n=v(n,{event:e})),m(t.echo,a,n))}function a(t){t.on("in",this)}function s(t,e){var o,r,i=this.cat.next||p,u=this.at;(_!==e||i[e])&&(r=i[e])&&(r.has?(t&&t[y]&&n.val.rel.is(t)===n.node.soul(r.put)||(r.put=t),o=r.gun):o=u.gun.get(e),r.on("in",{put:t,get:e,gun:o,via:u}))}function f(t,e){if(t.has||t.soul){var o=t.map,r=t.root;t.map=null,(r.now&&r.now[t.id]||e["@"]||null!==o)&&(l===o&&n.val.rel.is(t.put)||(m(o,function(n){(n=n.at)&&d(n.echo,t.id)}),m(t.next,function(t,n){t.put=l,t.ack&&(t.ack=-1),t.on("in",{get:n,gun:t.gun,put:l})})))}}function c(t,e){var o=this.as,r=o.get||p,i=o.gun._,u=(t.put||p)[r["#"]];if(i.ack&&(i.ack=i.ack+1||1),!t.put||r["."]&&!g(u,i.get)){if(i.put!==l)return;i.on("in",{get:i.get,put:i.put=l,gun:i.gun,"@":t["@"]})}else _!=r["."]?(t.gun=i.root.gun,n.on.put(t,i.root.gun)):i.on("in",{get:i.get,put:u[i.get],gun:i.gun,"@":t["@"]})}n.chain.chain=function(t){var r,i=this._,u=new(t||this).constructor(this),a=u._;return a.root=r=i.root,a.id=++r.once,a.back=this._,a.on=n.on,a.on("in",o,a),a.on("out",e,a),u};var l,p={},h=n.obj,g=h.has,d=(h.put,h.del),v=h.to,m=h.map,b=n.text.random,y=n.val.rel._,_=n.node._})(i,"./chain"),i(function(t){var n=i("./root");function e(t){var n,e=this,r=e.as,i=t.gun._,a=i.root,s=t.put;if((n=a.now)&&e!==n[r.now])return e.to.next(t);void 0===s&&(s=i.put),(n=s)&&n[u._]&&(n=u.is(n))&&void 0!==(n=i.root.gun.get(n)._).put&&(t=o(t,{put:n.put})),r.use(t,t.event||e),e.to.next(t)}n.chain.get=function(t,o,i){var s;if("string"!=typeof t){if(t instanceof Function){var f,c=(s=this)._,l=c.root,p=l.now;return(i=o||{}).use=t,i.out=i.out||{},i.out.get=i.out.get||{},f=c.on("in",e,i),(l.now={$:1})[i.now=c.id]=f,c.on("out",i.out),l.now=p,s}return r(t)?this.get(""+t,o,i):(p=u.is(t))?this.get(p,o,i):((i=this.chain())._.err={err:n.log("Invalid get request!",t)},o&&o.call(i,i._.err),i)}var h=this._;return(s=(h.next||a)[t])||(s=function(t,n){var e=n._,o=e.next,r=n.chain()._;return o||(o=e.next={}),o[r.get=t]=r,n===e.root.gun?r.soul=t:(e.soul||e.has)&&(r.has=t),r}(t,this)),s=s.gun,(p=h.stun)&&(s._.stun=s._.stun||p),o&&o instanceof Function&&s.get(o,i),s},n.obj.has;var o=n.obj.to,r=n.num.is,u=n.val.rel,a=(n.node._,{})})(i,"./get"),i(function(t){var n=i("./root");function o(t){t&&t()}function u(){var t=this;t.graph&&!d(t.stun,a)&&(t.res=t.res||function(t){t&&t()},t.res(function(){var n=t.gun.back(-1)._,e=n.ask(function(e){n.root.on("ack",e),this.off(),t.ack&&t.ack(e,this)},t.opt),o=n.root.now;p.del(n.root,"now"),n.root.PUT=!0;var r=n.root.stop;t.ref._.now=!0,t.ref._.on("out",{gun:t.ref,put:t.out=t.env.graph,opt:t.opt,"#":e}),p.del(t.ref._,"now"),p.del(n.root,"PUT"),n.root.now=o,n.root.stop=r},t),t.res&&t.res())}function a(t,n){if(t)return!0}function s(t,e,o,r){var i=this;!e&&r.path.length&&(i.res||b)(function(){for(var t=r.path,e=i.ref,o=(i.opt,0),u=t.length;o<u;o++)e=e.get(t[o]);if(n.node.soul(r.obj)){var a=n.node.soul(r.obj)||(i.via.back("opt.uuid")||n.text.random)();return a?(e.back(-1).get(a),void r.soul(a)):((i.stun=i.stun||{})[t]=!0,void i.via.back("opt.uuid")(function(o,u){if(o)return n.log(o);e.back(-1).get(u),r.soul(u),i.stun[t]=!1,i.batch()}))}(i.stun=i.stun||{})[t]=!0,e.get("_").get(f,{as:{at:r,as:i}})},{as:i,at:r})}function f(t,e){var o=this.as,r=o.at;if(o=o.as,t.gun&&t.gun._.back){var i=t.gun._,u=i,a=(t.put||v)["#"];e.off(),i=t.gun._.back;var s=s||n.node.soul(r.obj)||n.node.soul(i.put)||n.val.rel.is(i.put)||a||u._id||(o.via.back("opt.uuid")||n.text.random)();s?c(i,u._id=u._id||s,r,o):i.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);c(i,u._id=u._id||e,r,o)})}}function c(t,n,e,o){t.gun.back(-1).get(n),e.soul(n),o.stun[e.path]=!1,o.batch()}function l(t,e){var o=this.as;if(t.gun&&t.gun._)if(t.err)r.log("Please report this as an issue! Put.any.err");else{var i,u=t.gun._.back,a=u.put,s=o.opt||{};if(!(i=o.ref)||!i._.now){if(e.off(),o.ref!==o.gun){if(!(i=o.gun._.get||u.get))return void r.log("Please report this as an issue! Put.no.get");o.data=g({},i,o.data),i=null}if(void 0===a){if(!u.get)return;u.soul||(i=u.gun.back(function(t){if(t.soul)return t.soul;o.data=g({},t.get,o.data)})),i=i||u.get,u=u.root.gun.get(i)._,o.not=o.soul=i,a=o.data}o.not||(o.soul=n.node.soul(a))||(o.path&&h(o.data)?o.soul=(s.uuid||o.via.back("opt.uuid")||n.text.random)():(y==t.get&&(o.soul=(t.put||v)["#"]||t._id),o.soul=o.soul||t.soul||u.soul||(s.uuid||o.via.back("opt.uuid")||n.text.random)()),o.soul)?o.ref.put(o.data,o.soul,o):o.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);o.ref.put(o.data,o.soul=e,o)})}}}n.chain.put=function(t,r,i){var a,f=this,c=f._,p=c.root.gun;return(i=i||{}).data=t,i.via=i.gun=i.via||i.gun||f,"string"==typeof r?i.soul=r:i.ack=i.ack||r,c.soul&&(i.soul=c.soul),i.soul||p===f?h(i.data)?(i.soul=i.soul||(i.not=n.node.soul(i.data)||(i.via.back("opt.uuid")||n.text.random)()),i.soul?(i.gun=f=p.get(i.soul),i.ref=i.gun,function(t){t.batch=u;var e=t.opt||{},o=t.env=n.state.map(s,e.state);if(o.soul=t.soul,t.graph=n.graph.ify(t.data,o,t),o.err)return(t.ack||m).call(t,t.out={err:n.log(o.err)}),t.res&&t.res();t.batch()}(i)):i.via.back("opt.uuid")(function(t,e){if(t)return n.log(t);(i.ref||i.gun).put(i.data,i.soul=e,i)}),f):((i.ack||m).call(i,i.out={err:n.log("Data saved to the root level of the graph must be a node (an object), not a",e(i.data),'of "'+i.data+'"!')}),i.res&&i.res(),f):n.is(t)?(t.get("_").get(function(t,o,u){if(o.off(),!(u=t.gun)||!(u=u._.back)||!u.soul)return n.log("The reference you are saving is a",e(t.put),'"'+i.put+'", not a node (object)!');f.put(n.val.rel.ify(u.soul),r,i)}),f):(i.ref=i.ref||p._===(a=c.back)?f:a.gun,i.ref._.soul&&n.val.is(i.data)&&c.get?(i.data=g({},c.get,i.data),i.ref.put(i.data,i.soul,i)):(i.ref.get("_").get(l,{as:i}),i.out||(i.res=i.res||o,i.gun._.stun=i.ref._.stun)),f)};var p=n.obj,h=p.is,g=p.put,d=p.map,v={},m=function(){},b=function(t,n){t.call(n||v)},y=n.node._})(i,"./put"),i(function(t){var n=i("./root");i("./chain"),i("./back"),i("./put"),i("./get"),t.exports=n})(i,"./index"),i(function(t){var n=i("./index");function e(t,e){var o=this,i=t.gun,u=i._,a=u.put||t.put,s=o.last,c=u.id+t.get;if(r!==a){if(a&&a[f._]&&(s=f.is(a))){if(s=u.root.gun.get(s)._,r===s.put)return;a=s.put}o.change&&(a=t.put),(s.put!==a||s.get!==c||n.node.soul(a))&&(s.put=a,s.get=c,u.last=a,o.as?o.ok.call(o.as,t,e):o.ok.call(i,a,t.get,t,e))}}function o(t,e,i){var u,a=this.as,s=a.cat,c=t.gun._,l=c.put||t.put;if(u=n.node.soul(l)||f.is(l)){if(u=s.root.gun.get(u)._,r===u.put)return;l=u.put}if(e.wait&&clearTimeout(e.wait),i){if(s.has||s.soul){if(e.off())return}else{if((a.seen=a.seen||{})[c.id])return;a.seen[c.id]=!0}a.ok.call(t.gun||a.gun,l,t.get)}else e.wait=setTimeout(function(){o.call({as:a},t,e,e.wait||1)},a.wait||99)}n.chain.on=function(t,n,o,r){var i,u,a=this,s=a._;if("string"==typeof t)return n?(i=s.on(t,n,o||s,r),o&&o.gun&&(o.subs||(o.subs=[])).push(i),(u=function(){i&&i.off&&i.off(),u.off()}).off=a.off.bind(a)||c,a.off=u,a):s.on(t);var f=n;return(f=!0===f?{change:!0}:f||{}).ok=t,f.last={},a.get(e,f),a},n.chain.val=function(t,e){return n.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,e)},n.chain.once=function(t,e){var i=this,u=i._,a=u.put;if(0<u.ack&&r!==a)return(t||c).call(i,a,u.get),i;if(!t){n.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var s=i.chain();return s._.val=i.once(function(){s._.on("in",i._)}),s}return(e=e||{}).ok=t,e.cat=u,e.out={"#":n.text.random(9)},i.get(o,{as:e}),e.async=!0,i},n.chain.off=function(){var t,n=this._,e=n.back;if(e)return(t=e.next)&&t[n.get]&&s(t,n.get),(t=e.ask)&&s(t,n.get),(t=e.put)&&s(t,n.get),(t=n.soul)&&s(e.root.graph,t),(t=n.map)&&a(t,function(t){t.rel&&e.root.gun.get(t.rel).off()}),(t=n.next)&&a(t,function(t){t.gun.off()}),n.on("off",{}),this};var r,u=n.obj,a=u.map,s=(u.has,u.del),f=(u.to,n.val.rel),c=function(){}})(i,"./on"),i(function(t){var n=i("./index");function e(t){t.put&&!n.val.is(t.put)&&(this.as.val&&this.off(),r(t.put,o,{at:this.as,msg:t}),this.to.next(t))}function o(t,n){if(a!==n){var e=this.msg.gun,o=this.at,r=e.get(n)._;(r.echo||(r.echo={}))[o.id]=o}}n.chain.map=function(t,o,r){var i,a=this,s=a._;return t?(n.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),i=a.chain(),a.map().on(function(e,o,r,a){var s=(t||u).call(this,e,o,r,a);void 0!==s&&(n.is(s)?i._.on("in",s._):i._.on("in",{get:o,put:s,gun:i}))})):(i=s.fields)||((i=s.fields=a.chain())._.val=a.back("val"),i._.MAPOF=s.soul,a.on("in",e,i._)),i};var r=n.obj.map,u=function(){},a=n.node._})(i,"./map"),i(function(t){var n=i("./index");n.chain.set=function(t,e,o){var r,i=this;if(e=e||function(){},(o=o||{}).item=o.item||t,r=n.node.soul(t))return i.set(i.back(-1).get(r),e,o);if(!n.is(t)){var u=i.back("opt.uuid")();return u&&n.obj.is(t)?i.set(i._.root.gun.put(t,u),e,o):i.get(n.state.lex()+n.text.random(7)).put(t,e,o)}return t.get("_").get(function(t,r){if(t.gun&&t.gun._.back){r.off();var u=(t.put||{})["#"],a=(t=t.gun._.back).put;if(!(u=t.soul||n.node.soul(a)||u))return e.call(i,{err:n.log('Only a node can be linked! Not "'+a+'"!')});i.put(n.obj.put({},u,n.val.rel.ify(u)),e,o)}},{wait:0}),t}})(i,"./set"),i(function(t){if("undefined"!=typeof Gun){var n,e=function(){};"undefined"!=typeof window&&(n=window);var o=n.localStorage||{setItem:e,removeItem:e,getItem:e};Gun.on("create",function(t){var n=this.to,e=t.opt;if(t.once)return n.next(t);if(!1===e.localStorage)return n.next(t);e.file=e.file||"gun/";var r,i,u=Gun.obj.ify(o.getItem("gap/"+e.file))||{},a=Gun.obj.empty;function s(t){if(!t.err&&t.ok){var n=t["@"];setTimeout(function(){Gun.obj.map(u,function(t,e){Gun.obj.map(t,function(e,o){n===e&&delete t[o]}),a(t)&&delete u[e]}),c()},e.wait||1)}}a(u)||t.on("localStorage",function(n){this.off();var e={};Gun.obj.map(u,function(t,o){Gun.obj.map(t,function(t,r){e[o]=Gun.state.to(n[o],r,e[o])})}),setTimeout(function(){t.on("out",{put:e,"#":t.ask(s),I:t.gun})},10)}),t.on("out",function(t){t.lS||(t.I&&t.put&&!t["@"]&&!a(e.peers)&&(r=t["#"],Gun.graph.is(t.put,null,f),i||(i=setTimeout(c,e.wait||1))),this.to.next(t))}),t.on("ack",s),n.next(t);var f=function(t,n,e,o){(u[o]||(u[o]={}))[n]=r},c=function(){clearTimeout(i),i=!1;try{o.setItem("gap/"+e.file,JSON.stringify(u))}catch(t){Gun.log(err=t||"localStorage failure")}}}),Gun.on("create",function(t){this.to.next(t);var n=t.opt;if(!t.once&&!1!==n.localStorage){n.file=n.file||n.prefix||"gun/",t.graph;var e,r={},i=0,u=Gun.obj.ify(o.getItem(n.file))||{};t.on("localStorage",u),t.on("put",function(t){if(this.to.next(t),Gun.graph.is(t.put,null,a),t["@"]||(r[t["#"]]=!0),(i+=1)>=(n.batch||1e3))return s();e||(e=setTimeout(s,n.wait||1))}),t.on("get",function(e){this.to.next(e);var o,r,i=e.get;if(i&&(o=i["#"])){var a=i["."];(r=u[o]||void 0)&&a&&(r=Gun.state.to(r,a)),(r||Gun.obj.empty(n.peers))&&t.on("in",{"@":e["#"],put:Gun.graph.node(r),how:"lS",lS:e.I})}});var a=function(t,n,e,o){u[o]=Gun.state.to(e,n,u[o])},s=function a(s){var f;i=0,clearTimeout(e),e=!1;var c=r;r={},s&&(u=s);try{o.setItem(n.file,JSON.stringify(u))}catch(s){Gun.log(f=s||"localStorage failure"),t.on("localStorage:error",{err:f,file:n.file,flush:u,retry:a})}(f||Gun.obj.empty(n.peers))&&Gun.obj.map(c,function(n,e){t.on("in",{"@":e,err:f,ok:0})})}}})}})(i,"./adapters/localStorage"),i(function(t){var n=i("../type");function e(t){var i=function(){};return i.out=function(n){var e;if(this.to&&this.to.next(n),(e=n["@"])&&(e=t.dup.s[e])&&(e=e.it)&&e.mesh)return i.say(n,e.mesh.via),void(e["##"]=n["##"]);i.say(n)},i.hear=function(e,o){if(e){var r,u,a,s=t.dup,f=e[0];try{a=JSON.parse(e)}catch(e){}if("{"===f){if(!a)return;if(s.check(r=a["#"]))return;if((f=(s.track(r,!0).it=a)["@"])&&a.put&&(f+=u=a["##"]||(a["##"]=i.hash(a)))!=r){if(s.check(f))return;(f=s.s)[u]=f[r]}return(a.mesh=function(){}).via=o,(f=a["><"])&&(a.mesh.to=n.obj.map(f.split(","),function(t,n,e){e(t,!0)})),void t.on("in",a)}if("["!==f);else{if(!a)return;for(var c,l=0;c=a[l++];)i.hear(c,o)}}},function(){function e(t,n){var e=n.wire;try{e.send?e.readyState===e.OPEN?e.send(t):(n.queue=n.queue||[]).push(t):n.say&&n.say(t)}catch(e){(n.queue=n.queue||[]).push(t)}}i.say=function(o,u){var a,s,f;u?(u.wire||t.opt.wire&&t.opt.wire(u))&&(s=o.mesh||r,u!==s.via&&((f=s.raw)||(f=i.raw(o)),(a=o["@"])&&(a=t.dup.s[a])&&(a=a.it)&&a.get&&a["##"]&&a["##"]===o["##"]||(a=s.to)&&(a[u.url]||a[u.id])||(u.batch?u.batch.push(f):(u.batch=[],setTimeout(function(){var t=u.batch;t&&(u.batch=null,t.length&&e(JSON.stringify(t),u))},t.opt.gap||t.opt.wait||1),e(f,u))))):n.obj.map(t.opt.peers,function(t){i.say(o,t)})}}(),function(){function r(t,e){var o;return e instanceof Object?(n.obj.map(Object.keys(e).sort(),u,{to:o={},on:e}),o):e}function u(t){this.to[t]=this.on[t]}i.raw=function(e){if(!e)return"";var u,f,c,l=t.dup,p=e.mesh||{};if(c=p.raw)return c;if("string"==typeof e)return e;e["@"]&&(c=e.put)&&((f=e["##"])||(u=a(c,r)||"",f=i.hash(e,u),e["##"]=f),(c=l.s)[f=e["@"]+f]=c[e["#"]],e["#"]=f||e["#"],u&&((e=n.obj.to(e)).put=s));var h=0,g=[];n.obj.map(t.opt.peers,function(t){if(g.push(t.url||t.id),9<++h)return!0}),e["><"]=g.join();var d=a(e);return o!==u&&(d=d.replace('"'+s+'"',u)),p&&(p.raw=d),d},i.hash=function(t,o){return e.hash(o||a(t.put,r)||"")||t["#"]||n.text.random(9)};var a=JSON.stringify,s=":])([:"}(),i.hi=function(e){t.on("hi",e);var o=e.queue;e.queue=[],n.obj.map(o,function(t){i.say(t,e)})},i}e.hash=function(t){if("string"!=typeof t)return{err:1};var n=0;if(!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n};var o,r={};Object.keys=Object.keys||function(t){return map(t,function(t,n,e){e(n)})};try{t.exports=e}catch(t){}})(i,"./adapters/mesh"),i(function(n){var e=i("../index");e.Mesh=i("./mesh"),e.on("opt",function(n){this.to.next(n);var o=n.opt;if(!n.once&&!1!==o.WebSocket){var r;"undefined"!=typeof window&&(r=window),void 0!==t&&(r=t),r=r||{};var i=o.WebSocket||r.WebSocket||r.webkitWebSocket||r.mozWebSocket;if(i){o.WebSocket=i;var u=o.mesh=o.mesh||e.Mesh(n);n.on("create",function(t){this.to.next(t),n.on("out",u.out)}),o.wire=o.wire||a}}function a(t){if(t&&t.url){var e=t.url.replace("http","ws"),i=t.wire=new o.WebSocket(e);return i.onclose=function(){n.on("bye",t),s(t)},i.onerror=function(n){s(t),n&&n.code},i.onopen=function(){u.hi(t)},i.onmessage=function(n){n&&(r.inLength=(r.inLength||0)+(n.data||n).length,u.hear(n.data||n,t))},i}}function s(t){clearTimeout(t.defer),t.defer=setTimeout(function(){a(t)},2e3)}})})(i,"./adapters/websocket")}()}).call(this,e(0),e(3)(t))},function(t,n,e){"use strict";var o=e(10),r=e(2);e(1).env.GUN_ENV="production",t.exports=r(o)},function(t,n,e){e(11),t.exports=e(5)}])});
//# sourceMappingURL=main.bundle.js.map